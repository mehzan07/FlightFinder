{% extends 'base.html' %}

{% block content %}
<div class="unified-app-wrapper">
    <div class="header" style="margin-top: 10px;">
        <h1 style="font-size: 24px; margin: 0; color: #333;">‚úàÔ∏è Flight Search Results</h1>
        <div class="route-info" style="margin-top: 8px; color: #666; font-size: 15px;">
            <span><strong>{{ origin }}</strong></span>
            <span class="arrow" style="margin: 0 5px;">
                {% if trip_type in ['round-trip', 'round_trip'] %}‚áÑ{% else %}‚Üí{% endif %}
            </span>
            <span><strong>{{ destination }}</strong></span>
            <span style="color: #ccc; margin: 0 8px;">|</span>
            <span>üìÖ {{ depart_date }}</span>
        </div>
    </div>

    <div class="action-bar" style="display: flex; gap: 12px; margin: 20px 0;">
        <a href="/travel-ui" class="btn-action btn-back" style="flex: 1;">
            ‚Üê Back to Search
        </a>
        <a href="https://search.hotellook.com/?location={{ destination[:3] }}&checkIn={{ depart_date }}&marker=665788&language=en" 
           target="_blank" class="btn-action btn-hotel" style="flex: 1;">
            üè† Find Hotels
        </a>
    </div>

    {% if flights %}
        <div style="margin-bottom: 15px; font-size: 15px; color: #888; font-weight: 500;">
            Found {{ flights|length }} flights
        </div>
        
        {% for flight in flights %}
            <div class="flight-card">
                <div class="flight-header">
                    <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
                        <div style="display: flex; align-items: center;">
                            <div class="airline-badge">{{ flight.airline_display }}</div>
                            <div style="margin-left: 12px;">
                                <div style="font-weight: bold; color: #333;">{{ flight.airline }}</div>
                                <small style="color: #aaa; text-transform: uppercase;">{{ trip_type }}</small>
                            </div>
                        </div>
                        <div class="price-tag">
                            {{ flight.price }} {{ currency or 'SEK' }}
                        </div>
                    </div>
                </div>
                
                <div class="flight-details">
                    <div style="flex: 1;">
                        <span class="time-display">
                            {{ flight.depart.split(' ')[1][:5] if (flight.depart and ' ' in flight.depart) else flight.depart }}
                        </span><br>
                        <small class="airport-code">{{ flight.origin }}</small>
                    </div>
                    
                    <div class="flight-path">
                        <hr>
                        <span class="plane-icon">‚úàÔ∏è</span>
                    </div>
                    
                    <div style="flex: 1;">
                        <span class="time-display">{{ flight.arrival_time }}</span><br>
                        <small class="airport-code">{{ flight.destination }}</small>
                    </div>
                </div>

                <div style="padding: 0 15px 15px 15px;">
                    <a href="{{ flight.deeplink }}&dest={{ destination|urlencode }}" target="_blank" class="book-btn">
                        Book Flight ‚Üí
                    </a>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <div class="no-results-container">
            <h2>üòï No flights found</h2>
            <p>We couldn't find matches for this route and date.</p>
            <a href="/travel-ui" class="btn-action btn-back" style="max-width: 200px; margin: 20px auto;">Try Again</a>
        </div>
    {% endif %}
</div>

<script>
    // iOS Install Prompt Logic
    window.addEventListener('load', function() {
        const isIos = /iphone|ipad|ipod/.test(window.navigator.userAgent.toLowerCase());
        const isStandalone = ('standalone' in window.navigator) && (window.navigator.standalone);
        const prompt = document.getElementById('ios-install-prompt');
        if (prompt && isIos() && !isStandalone) { prompt.style.display = 'block'; }
    });
    function closePrompt() { document.getElementById('ios-install-prompt').style.display = 'none'; }
</script>
{% endblock %}