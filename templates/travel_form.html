{% extends "base.html" %}
{% block content %}

<div class="container mt-5" style="background: linear-gradient(to right, #e0f7fa, #fff); padding: 2rem; border-radius: 10px;">
  <h2 class="mb-1">âœˆï¸ Plan Your Trip</h2>
  <p class="text-muted mb-4">Find the best flights, fast.</p>

  {% if errors %}
  <div class="alert alert-danger">
    <h5 class="mb-2">âš ï¸ Please fix the following:</h5>
    <ul class="mb-0">
      {% for error in errors %}
      <li>{{ error }}</li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}

  <form id="searchForm" method="POST" action="/search-flights" class="card p-4 shadow-sm">

    <div class="mb-3 position-relative">
      <label for="origin_text" class="form-label">From</label>
      <input type="text" class="form-control" id="origin_text" 
             placeholder="Enter city or airport" autocomplete="off"
             value="{% if form_data %}{{ form_data.origin_text }}{% else %}Stockholm Arlanda (ARN){% endif %}">
      
      <input type="hidden" id="origin_code" name="origin_code" 
             value="{% if form_data %}{{ form_data.origin_code }}{% else %}ARN{% endif %}">
      
      <div id="origin_text-list" class="autocomplete-suggestions"></div>
    </div>

    <div class="mb-3 position-relative">
      <label for="destination_text" class="form-label">To</label>
      <input type="text" class="form-control" id="destination_text" 
             placeholder="Enter city or airport" autocomplete="off"
             value="{% if form_data %}{{ form_data.destination_text }}{% else %}London Heathrow (LHR){% endif %}">
      
      <input type="hidden" id="destination_code" name="destination_code" 
             value="{% if form_data %}{{ form_data.destination_code }}{% else %}LHR{% endif %}">
      
      <div id="destination_text-list" class="autocomplete-suggestions"></div>
    </div>

    <div class="row">
      <div class="col-md-6 mb-3">
        <label class="form-label" for="trip_type">ğŸ§­ Trip Type</label>
        <select id="trip_type" name="trip_type" class="form-select" required>
          <option value="one-way" {% if form_data and form_data.trip_type == 'one-way' %}selected{% endif %}>One-way</option>
          <option value="round-trip" {% if not form_data or form_data.trip_type == 'round-trip' %}selected{% endif %}>Round-trip</option>
          <option value="multi-city" {% if form_data and form_data.trip_type == 'multi-city' %}selected{% endif %}>Multi-city</option>
        </select>
      </div>
      <div class="col-md-6 mb-3 d-flex align-items-end">
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" id="direct_only" name="direct_only"
                 {% if form_data and form_data.direct_only %}checked{% endif %}>
          <label class="form-check-label" for="direct_only">ğŸ›« Direct flights only</label>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6 mb-3">
        <label class="form-label" for="date_from">ğŸ“… Depart</label>
        <input type="date" id="date_from" name="date_from" class="form-control" required
               value="{{ session.last_search.departure if session.last_search else form_data.date_from if form_data else '2026-03-12' }}">
      </div>
      <div class="col-md-6 mb-3" id="returnDateGroup">
        <label class="form-label" for="date_to">ğŸ“… Return</label>
        <input type="date" id="date_to" name="date_to" class="form-control"
               value="{{ session.last_search.return if session.last_search else form_data.date_to if form_data else '2026-03-17' }}">
      </div>
    </div>
    
    <div id="multiCityGroup" style="display:none;" class="mt-4 p-3 border rounded bg-light">
      <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">âœˆï¸ Leg 2</h5>
          <button type="button" id="removeLeg2" class="btn-close" aria-label="Close"></button>
      </div>

      <div class="mb-3 position-relative">
    <label for="destination_text_2" class="form-label">To (Second Destination)</label>
    <input type="text" class="form-control" id="destination_text_2" 
           placeholder="Where next?" autocomplete="off"
           value="{% if form_data and form_data.destination_text_2 %}{{ form_data.destination_text_2 }}{% else %}Paris Charles de Gaulle (CDG){% endif %}">
    
    <input type="hidden" id="destination_code_2" name="destination_code_2" 
           value="{% if form_data and form_data.destination_code_2 %}{{ form_data.destination_code_2 }}{% else %}CDG{% endif %}">
    
    <div id="destination_text_2-list" class="autocomplete-suggestions"></div>
</div>

<div class="mb-3">
    <label class="form-label" for="date_from_2">ğŸ“… Date for Leg 2</label>
    <input type="date" id="date_from_2" name="date_from_2" class="form-control"
           value="{% if form_data and form_data.date_from_2 %}{{ form_data.date_from_2 }}{% else %}2026-03-23{% endif %}">
</div>
    </div>

    <div class="row mt-3">
      <div class="col-md-6 mb-3">
        <label class="form-label" for="passengers">ğŸ‘¥ Passengers</label>
        <input type="number" id="passengers" name="passengers" class="form-control" min="1" max="9" required
               value="{{ form_data.passengers if form_data else 1 }}">
      </div>
      <div class="col-md-6 mb-3">
        <label class="form-label" for="cabin_class">ğŸ’º Cabin Class</label>
        <select id="cabin_class" name="cabin_class" class="form-select" required>
          <option value="economy" {% if not form_data or form_data.cabin_class == 'economy' %}selected{% endif %}>Economy</option>
          <option value="business" {% if form_data and form_data.cabin_class == 'business' %}selected{% endif %}>Business</option>
          <option value="first" {% if form_data and form_data.cabin_class == 'first' %}selected{% endif %}>First</option>
        </select>
      </div>
    </div>

    <div class="mb-3">
      <label for="limit" class="form-label">Max Flights to Show</label>
      <select class="form-select" name="limit" id="limit">
        <option value="4" {% if not form_data or form_data.limit == "4" %}selected{% endif %}>4</option>
        <option value="8" {% if form_data and form_data.limit == "8" %}selected{% endif %}>8</option>
        <option value="12" {% if form_data and form_data.limit == "12" %}selected{% endif %}>12</option>
        <option value="16" {% if form_data and form_data.limit == "16" %}selected{% endif %}>16</option>
      </select>
    </div>

    <div id="loading" class="text-center mb-3" style="display:none;">
      <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2">ğŸ”„ Searching flightsâ€¦ hang tight!</p>
    </div>

    <div class="d-flex align-items-center gap-2 mt-4">
        <button type="submit" class="btn btn-primary btn-lg px-4">Search Flights</button>
        <button type="button" id="clearFormBtn" class="btn btn-outline-secondary">ğŸ—‘ï¸ Clear All</button>
    </div>
  </form>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="/static/js/flightFinder.js"></script>

{% endblock %}